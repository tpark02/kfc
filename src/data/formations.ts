export const baseFormations = {
  "442": [
    { pos: "GK", top: 95, left: 50 },
    { pos: "LB", top: 70, left: 20 },
    { pos: "CB", top: 70, left: 40 },
    { pos: "CB", top: 70, left: 60 },
    { pos: "RB", top: 70, left: 80 },
    { pos: "LM", top: 50, left: 20 },
    { pos: "CAM", top: 50, left: 40 },
    { pos: "CAM", top: 50, left: 60 },
    { pos: "RM", top: 50, left: 80 },
    { pos: "ST", top: 30, left: 40 },
    { pos: "ST", top: 30, left: 60 },
  ],
  "433": [
    { pos: "GK", top: 95, left: 50 },
    { pos: "LB", top: 70, left: 20 },
    { pos: "CB", top: 70, left: 40 },
    { pos: "CB", top: 70, left: 60 },
    { pos: "RB", top: 70, left: 80 },
    { pos: "CAM", top: 55, left: 35 },
    { pos: "CAM", top: 50, left: 50 },
    { pos: "CAM", top: 55, left: 65 },
    { pos: "LW", top: 30, left: 20 },
    { pos: "ST", top: 25, left: 50 },
    { pos: "RW", top: 30, left: 80 },
  ],
  "352": [
    { pos: "GK", top: 90, left: 50 },
    { pos: "LB", top: 70, left: 30 },
    { pos: "CB", top: 70, left: 50 },
    { pos: "RB", top: 70, left: 70 },
    { pos: "LM", top: 55, left: 15 },
    { pos: "LM", top: 55, left: 35 },
    { pos: "CM", top: 50, left: 50 },
    { pos: "RM", top: 55, left: 65 },
    { pos: "RM", top: 55, left: 85 },
    { pos: "ST", top: 30, left: 40 },
    { pos: "ST", top: 30, left: 60 },
  ],
  "4231": [
    { pos: "GK", top: 90, left: 50 },
    { pos: "LB", top: 62.5, left: 20 },
    { pos: "CB", top: 72, left: 40 },
    { pos: "CB", top: 72.5, left: 60 },
    { pos: "RB", top: 62.5, left: 80 },
    { pos: "CDM", top: 52.5, left: 40 },
    { pos: "CDM", top: 52.5, left: 60 },
    { pos: "LM", top: 37.5, left: 30 },
    { pos: "CAM", top: 37.5, left: 50 },
    { pos: "RM", top: 37.5, left: 70 },
    { pos: "ST", top: 22.5, left: 50 },
  ],
  "451": [
    { pos: "GK", top: 85.0, left: 50 },
    { pos: "LB", top: 65.0, left: 20 },
    { pos: "CB", top: 65.0, left: 40 },
    { pos: "CB", top: 65.0, left: 60 },
    { pos: "RB", top: 65.0, left: 80 },
    { pos: "LM", top: 50.0, left: 20 },
    { pos: "CM", top: 50.0, left: 40 },
    { pos: "CM", top: 50.0, left: 60 },
    { pos: "RM", top: 50.0, left: 80 },
    { pos: "CAM", top: 35.0, left: 50 },
    { pos: "ST", top: 20.0, left: 50 },
  ],
  "343": [
    { pos: "GK", top: 83, left: 50 },
    { pos: "LB", top: 62.5, left: 30 },
    { pos: "CB", top: 62.5, left: 50 },
    { pos: "RB", top: 62.5, left: 70 },
    { pos: "LM", top: 47.5, left: 20 },
    { pos: "CM", top: 47.5, left: 40 },
    { pos: "CM", top: 47.5, left: 60 },
    { pos: "RM", top: 47.5, left: 80 },
    { pos: "LW", top: 27.5, left: 30 },
    { pos: "ST", top: 22.5, left: 50 },
    { pos: "RW", top: 27.5, left: 70 },
  ],
  "532": [
    { pos: "GK", top: 90, left: 50 },
    { pos: "LB", top: 57.5, left: 20 },
    { pos: "CB", top: 68.5, left: 35 },
    { pos: "CB", top: 72.5, left: 50 },
    { pos: "CB", top: 68.5, left: 65 },
    { pos: "RB", top: 57.5, left: 80 },
    { pos: "LM", top: 40.5, left: 35 },
    { pos: "CM", top: 50.5, left: 50 },
    { pos: "RM", top: 40.5, left: 65 },
    { pos: "ST", top: 22.5, left: 40 },
    { pos: "ST", top: 22.5, left: 60 },
  ],
  "541": [
    // 🧤 Goalkeeper
    { pos: "GK", top: 95, left: 47.5 },

    // 🛡 Defenders
    { pos: "LB", top: 72, left: 7.5 },
    { pos: "CB", top: 75, left: 27.5 },
    { pos: "CB", top: 75, left: 47.5 },
    { pos: "CB", top: 75, left: 67.5 },
    { pos: "RB", top: 72, left: 87.5 },

    // 🧠 Midfielders
    { pos: "LM", top: 48, left: 12.5 },
    { pos: "CM", top: 48, left: 32.5 },
    { pos: "CM", top: 48, left: 62.5 },
    { pos: "RM", top: 48, left: 82.5 },

    // ⚔️ Striker
    { pos: "ST", top: 28, left: 47.5 },
  ],

  "41212": [
    { pos: "GK", top: 85, left: 50 },
    { pos: "LB", top: 62.5, left: 20 },
    { pos: "CB", top: 62.5, left: 40 },
    { pos: "CB", top: 62.5, left: 60 },
    { pos: "RB", top: 62.5, left: 80 },
    { pos: "LM", top: 42.5, left: 35 },
    { pos: "CDM", top: 52.5, left: 50 },
    { pos: "RM", top: 42.5, left: 65 },
    { pos: "CAM", top: 32.5, left: 50 },
    { pos: "ST", top: 22.5, left: 40 },
    { pos: "ST", top: 22.5, left: 60 },
  ],
  "4222": [
    // 🧤 Goalkeeper
    { pos: "GK", top: 98, left: 50 },

    // 🛡 Fullbacks (standard)
    { pos: "LB", top: 68, left: 20 },
    { pos: "RB", top: 68, left: 80 },

    // 🛡 Center Backs (deeper than CDMs)
    { pos: "CB", top: 78, left: 42 },
    { pos: "CB", top: 78, left: 58 },

    // 🧠 Defensive Midfielders
    { pos: "CDM", top: 55, left: 40 },
    { pos: "CDM", top: 55, left: 60 },

    // 🎯 Wide Attacking Midfielders
    { pos: "LM", top: 44, left: 27 },
    { pos: "RM", top: 44, left: 73 },

    // ⚔️ Strikers
    { pos: "ST", top: 28, left: 42 },
    { pos: "ST", top: 28, left: 58 },
  ],

  "4321": [
    { pos: "GK", top: 80, left: 50 },
    { pos: "LB", top: 62.5, left: 20 },
    { pos: "CB", top: 62.5, left: 40 },
    { pos: "CB", top: 62.5, left: 60 },
    { pos: "RB", top: 62.5, left: 80 },
    { pos: "LM", top: 47.5, left: 35 },
    { pos: "CM", top: 42.5, left: 50 },
    { pos: "RM", top: 47.5, left: 65 },
    { pos: "CAM", top: 32.5, left: 40 },
    { pos: "CAM", top: 32.5, left: 60 },
    { pos: "ST", top: 22.5, left: 50 },
  ],
  "4132": [
    { pos: "GK", top: 85, left: 50 },
    { pos: "LB", top: 62.5, left: 20 },
    { pos: "CB", top: 62.5, left: 40 },
    { pos: "CB", top: 62.5, left: 60 },
    { pos: "RB", top: 62.5, left: 80 },
    { pos: "LM", top: 42.5, left: 25 },
    { pos: "CM", top: 52.5, left: 50 },
    { pos: "CM", top: 35.5, left: 50 },
    { pos: "RM", top: 42.5, left: 75 },
    { pos: "ST", top: 22.5, left: 40 },
    { pos: "ST", top: 22.5, left: 60 },
  ],
  "424": [
    // 🧤 Goalkeeper
    { pos: "GK", top: 100, left: 50 },

    // 🛡 Back 4
    { pos: "LB", top: 75, left: 20 },
    { pos: "CB", top: 80, left: 40 },
    { pos: "CB", top: 80, left: 60 },
    { pos: "RB", top: 75, left: 80 },

    // 🧠 Midfield 2 (deeper)
    { pos: "CDM", top: 55, left: 40 },
    { pos: "CDM", top: 55, left: 60 },

    // 🪂 Wingers
    { pos: "LW", top: 38, left: 15 },
    { pos: "RW", top: 38, left: 85 },

    // ⚔️ Strikers
    { pos: "ST", top: 30, left: 35 },
    { pos: "ST", top: 30, left: 65 },
  ],
};

export const centerFormationVertically = (
  formation: { pos: string; top: number; left: number }[]
) => {
  const tops = formation.map((p) => p.top);
  const minTop = Math.min(...tops);
  const maxTop = Math.max(...tops);
  const center = (minTop + maxTop) / 2;
  const offset = 45 - center;
  const offsetL = -5;
  return formation.map((p) => ({
    ...p,
    top: p.top + offset,
    left: p.left + offsetL,
  }));
};

export const formations = {
  "442": centerFormationVertically(baseFormations["442"]),
  "433": centerFormationVertically(baseFormations["433"]),
  "352": centerFormationVertically(baseFormations["352"]),
  "4231": centerFormationVertically(baseFormations["4231"]),
  "451": centerFormationVertically(baseFormations["451"]),
  "343": centerFormationVertically(baseFormations["343"]),
  "532": centerFormationVertically(baseFormations["532"]),
  "541": centerFormationVertically(baseFormations["541"]),
  "41212": centerFormationVertically(baseFormations["41212"]),
  "4222": centerFormationVertically(baseFormations["4222"]),
  "4321": centerFormationVertically(baseFormations["4321"]),
  "4132": centerFormationVertically(baseFormations["4132"]),
  "424": centerFormationVertically(baseFormations["424"]),
};

export const positionMultiplier: { [key: string]: number } = {
  GK: 0.9,
  CB: 1.0,
  LB: 1.0,
  RB: 1.0,
  CDM: 1.05,
  CM: 1.1,
  CAM: 1.15,
  LM: 1.1,
  RM: 1.1,
  LW: 1.2,
  RW: 1.2,
  ST: 1.3,
  CF: 1.25,
};

// const defenders = ["GK", "CB", "LB", "RB", "LWB", "RWB", "CDM"];
// const attackers = ["ST", "CF", "CAM", "LW", "RW", "LM", "RM"];

// export const estimateValue = (player: { ovr: number; pos: string }) => {
//   const baseValue = Math.pow(player.ovr, 2) * 1000;
//   const multiplier = positionMultiplier[player.pos] ?? 1;
//   return Math.round(baseValue * multiplier);
// };

// export const gettotalSquadValue = (players: {
//   [index: number]: Player | null;
// }) => {
//   return Object.values(players).reduce((sum, player) => {
//     return sum + (player ? estimateValue(player) : 0);
//   }, 0);
// };

// export const getPaceIndex = (players: { [index: number]: Player | null }) => {
//   if (Object.keys(players).length === 0) return 0;
//   const totalPace = Object.values(players).reduce(
//     (sum, player) => sum + (player ? player.pac : 0),
//     0
//   );
//   return Math.round(totalPace / Object.keys(players).length);
// };

// export const getDefenseAttackSplit = (players: {
//   [index: number]: Player | null;
// }) => {
//   const defPlayers = Object.values(players)?.filter(
//     (p) => p && defenders.includes(p.pos)
//   );
//   const atkPlayers = Object.values(players)?.filter(
//     (p) => p && attackers.includes(p.pos)
//   );

//   const avgDefending =
//     (defPlayers?.reduce((sum, p) => sum + (p?.def ?? 0), 0) ?? 0) /
//     (defPlayers?.length || 1);

//   const avgShooting =
//     (atkPlayers?.reduce((sum, p) => sum + (p ? p.sho : 0), 0) ?? 0) /
//     (atkPlayers?.length || 1);

//   return {
//     defense: Math.round(avgDefending),
//     attack: Math.round(avgShooting),
//   };
// };

// export const getTeamStamina = (players: { [index: number]: Player | null }) => {
//   const totalstamina = Object.values(players)?.reduce(
//     (sum, player) => sum + (player ? player.stamina : 0),
//     0
//   );
//   return Math.round(totalstamina / Object.values(players).length);
// };

// const getNationalitySpread = (players: { [index: number]: Player | null }) => {
//   const uniqueNations = new Set(Object.values(players).map((p) => p?.nation));
//   return uniqueNations;
// };

// const getLeagueSpread = (players: { [index: number]: Player | null }) => {
//   const uniqueLeagues = new Set(Object.values(players).map((p) => p?.league));
//   return uniqueLeagues;
// };

// const getClubCohesion = (players: { [index: number]: Player | null }) => {
//   const clubCountMap: { [club: string]: number } = {};

//   Object.values(players).forEach((p: Player | null) => {
//     if (p && p.team) {
//       clubCountMap[p.team] = (clubCountMap[p.team] || 0) + 1;
//     }
//   });

//   const maxCount = Math.max(...Object.values(clubCountMap));
//   return maxCount;
// };

// const getTeamOvr = (players: { [index: number]: Player | null }) => {
//   const totalovr = Object.values(players).reduce((sum, p) => {
//     return sum + (p ? p.ovr : 0);
//   }, 0);
//   return Math.ceil(totalovr / 11);
// };

// const getTeamAge = (players: { [index: number]: Player | null }) => {
//   const totalage = Object.values(players).reduce((sum, p) => {
//     return sum + (p ? p.age : 0);
//   }, 0);
//   return Math.ceil(totalage / 11);
// };

// export const metrics = (players: { [index: number]: Player | null }) => {
//   return {
//     teamovr: getTeamOvr(players),
//     teamage: getTeamAge(players),
//     squadvalue: gettotalSquadValue(players),
//     nationalityspread: getNationalitySpread(players),
//     leaguespread: getLeagueSpread(players),
//     clubcohesion: getClubCohesion(players),
//     teamstamina: getTeamStamina(players),
//     teamdef: getDefenseAttackSplit(players).defense,
//     teamattack: getDefenseAttackSplit(players).attack,
//     teampace: getPaceIndex(players),
//   };
// };
